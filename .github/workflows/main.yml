name: 自动采集
on:
  workflow_dispatch:
  schedule:
    - cron: '10 */3 * * *'
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: 迁出代码
      uses: actions/checkout@v2
    - name: 设置时区
      run: sudo timedatectl set-timezone 'Asia/Shanghai'
    - name: 部署规则转换服务
      run: |
        bash VmessActions/convert.sh
    - name: 爬取代理池
      run: |
        bash VmessActions/pool.sh
    - name: 提交更改
      run: |                 
         git config --local user.email "hansyow@gmail.com"
         git config --local user.name "hansyao"
         rm -rf subconverter
         git add -f VmessActions/subscribe/
         if [[ $(git status | grep 'Changes to be committed') ]]; then git commit -m "更新订阅链接"; else echo '代理池没有变化'; fi
    - name: 推送更改
      uses:  ad-m/github-push-action@master
      with:
         branch: master
